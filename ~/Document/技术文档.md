## 1. 技术栈选型 (Tech Stack)

* **开发框架**：微信小程序原生框架 (WXML, WXSS, JavaScript)。
* **状态管理**：全局变量 `app.globalData` 或 轻量级状态管理（如 MobX）。
* **图表库**：`ECharts for WeChat`（用于统计页柱状图）。
* **存储方案**：本地缓存 `wx.getStorage/setStorage`（主） + 云开发云数据库（选配，用于数据同步）。
* **UI 组件库**：微信原生组件 或 `Vant Weapp`（辅助布局）。

---

## 2. 核心功能逻辑实现

### 2.1 圆形进度条与打卡 (Home Page)

* **实现原理**：使用 `<canvas>` 绘图或 CSS3 的 `conic-gradient` 渐变实现。
* **计算公式**：
* 
* 


* **打卡逻辑**：每次点击，`currentWater` + 1，同时通过 `wx.vibrateShort` 触发震动反馈，提升交互质感。

### 2.2 提醒通知机制 (Notice)

* **技术方案**：微信**订阅消息** (`wx.requestSubscribeMessage`)。
* **逻辑**：由于小程序无法在后台自主运行计时器，通常采用以下策略：
1. 用户每次打卡时，计算下一次提醒时间。
2. 引导用户勾选“允许提醒”。
3. 利用云开发“云函数”的 **定时触发器 (Timer)** 检查待发送名单并推送。



### 2.3 勋章解锁算法 (Achievement)

* **触发器设计**：在每次打卡成功的回调函数中执行 `checkBadges()`。
* **判定逻辑**：
* **连续打卡**：比对 `lastDate` 与当前日期。
* **特定时间**：判断 `new Date().getHours()` 是否在 0-8 点之间。


* **持久化**：解锁后的勋章 ID 存入 `achievedList` 数组。

---

## 3. 数据库与存储设计 (Data Schema)

### 3.1 用户设置 (Settings)

```json
{
  "uid": "wx_uuid_01",
  "dailyGoal": 8,       // 目标杯数
  "interval": 60,       // 提醒间隔(分钟)
  "quietHours": {       // 免打扰时间
    "start": "23:00",
    "end": "07:00"
  }
}

```

### 3.2 饮水记录 (WaterLog)

```json
{
  "date": "2023-10-27",
  "logs": [
    {"time": "08:30:15", "volume": 1},
    {"time": "10:15:22", "volume": 1}
  ],
  "total": 2
}

```

---

## 4. 关键接口与 API 使用

| 模块 | 关键 API | 用途 |
| --- | --- | --- |
| **登录** | `wx.getUserProfile` | 获取头像昵称（需用户授权） |
| **震动** | `wx.vibrateShort` | 打卡成功的触感反馈 |
| **存储** | `wx.setStorageSync` | 离线保存饮水进度 |
| **图表** | `ec-canvas` | 渲染饮水统计柱状图 |

---

## 5. 核心页面路由配置 (app.json)

```json
{
  "pages": [
    "pages/home/index",        // 今日饮水
    "pages/stats/index",       // 统计
    "pages/medals/index",      // 成就
    "pages/settings/index",    // 设置
    "pages/login/index"        // 登录
  ],
  "tabBar": {
    "list": [
      { "pagePath": "pages/home/index", "text": "今日", "iconPath": "..." },
      { "pagePath": "pages/stats/index", "text": "统计", "iconPath": "..." },
      { "pagePath": "pages/medals/index", "text": "成就", "iconPath": "..." },
      { "pagePath": "pages/settings/index", "text": "设置", "iconPath": "..." }
    ]
  }
}

```

---

## 6. 异常处理与性能优化

* **跨天重置**：在 `onShow` 生命周期内校验当前时间，若日期已更新，则重置 `currentWater` 为 0。
* **首屏加载**：登录页插图采用 WebP 格式减少体积，提升加载速度。
* **本地存储限制**：定期清理 30 天以前的详细时间线日志，仅保留总数统计。